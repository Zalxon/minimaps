{"version":3,"file":"index.cjs","sources":["../src/regl.js","../src/minimap.js","../src/raster.js","../src/graticule.js","../src/path.js","../src/sphere.js"],"sourcesContent":["import React, {\n  createContext,\n  useCallback,\n  useState,\n  useEffect,\n  useContext,\n  useRef,\n} from 'react'\nimport _regl from 'regl'\n\nexport const ReglContext = createContext(null)\n\nexport const useRegl = () => {\n  return useContext(ReglContext)\n}\n\nconst Regl = ({ style, aspect, children }) => {\n  const regl = useRef()\n  const container = useRef(null)\n  const resize = useRef()\n  const [ready, setReady] = useState(false)\n  const [viewport, setViewport] = useState({ width: null, height: null })\n\n  useEffect(() => {\n    resize.current = () => {\n      container.current.style.height =\n        container.current.offsetWidth * aspect + 'px'\n\n      setViewport({\n        height: container.current.offsetWidth\n          ? container.current.offsetWidth * aspect\n          : container.current.style.height,\n        width: container.current.offsetWidth,\n      })\n    }\n    window.addEventListener('resize', resize.current)\n    resize.current()\n\n    if (!regl.current) {\n      regl.current = _regl({\n        container: container.current,\n        extensions: ['OES_texture_float', 'OES_element_index_uint'],\n      })\n      setReady(true)\n    }\n\n    return () => {\n      window.removeEventListener('resize', resize.current)\n    }\n  }, [aspect])\n\n  useEffect(() => {\n    return () => {\n      if (regl.current) regl.current.destroy()\n      setReady(false)\n    }\n  }, [])\n\n  return (\n    <ReglContext.Provider\n      value={{\n        regl: regl.current,\n        viewport,\n      }}\n    >\n      <div style={{ width: '100%', ...style }} ref={container} />\n      {ready && children}\n    </ReglContext.Provider>\n  )\n}\n\nexport default Regl\n","import React, {\n  useState,\n  useEffect,\n  useRef,\n  createContext,\n  useContext,\n} from 'react'\nimport Regl from './regl'\n\nconst DEFAULTS = {\n  naturalEarth1: {\n    aspect: 0.5,\n    scale: 1,\n    translate: [0, 0],\n  },\n  orthographic: {\n    aspect: 1,\n    scale: 3,\n    translate: [0, 0],\n  },\n  mercator: {\n    aspect: 1,\n    scale: 1,\n    translate: [0, 0],\n  },\n  equirectangular: {\n    aspect: 0.5,\n    scale: 1,\n    translate: [0, 0],\n  },\n}\n\nconst MinimapContext = createContext(null)\n\nexport const useMinimap = () => {\n  return useContext(MinimapContext)\n}\n\nconst Minimap = ({\n  id,\n  tabIndex,\n  className,\n  children,\n  projection: getProjection,\n  style,\n  aspect: aspectProp,\n  scale: scaleProp,\n  translate: translateProp,\n}) => {\n  const [projection, setProjection] = useState({\n    value: getProjection(),\n    scale: scaleProp,\n    aspect: aspectProp,\n    translate: translateProp,\n  })\n\n  const WIDTH = 800\n\n  useEffect(() => {\n    const updatedProjection = getProjection()\n    const defaults = DEFAULTS[updatedProjection.id]\n    const updatedScale = scaleProp || defaults.scale\n    const updatedAspect = aspectProp || defaults.aspect\n    const updatedTranslate = translateProp || defaults.translate\n\n    updatedProjection.scale(updatedScale * (WIDTH / (2 * Math.PI)))\n    updatedProjection.translate([\n      ((1 + updatedTranslate[0]) * WIDTH) / 2,\n      ((1 + updatedTranslate[1]) * updatedAspect * WIDTH) / 2,\n    ])\n\n    setProjection({\n      scale: updatedScale,\n      aspect: updatedAspect,\n      value: updatedProjection,\n      translate: updatedTranslate,\n    })\n  }, [getProjection, scaleProp, aspectProp, translateProp])\n\n  return (\n    <MinimapContext.Provider\n      value={{\n        projection: projection.value,\n        translate: projection.translate,\n        scale: projection.scale,\n        aspect: projection.aspect,\n        width: WIDTH,\n        height: WIDTH * projection.aspect,\n      }}\n    >\n      <div\n        id={id}\n        tabIndex={tabIndex}\n        className={className}\n        style={{\n          position: 'relative',\n          width: '100%',\n          overflow: 'hidden',\n          ...style,\n        }}\n      >\n        <Regl\n          aspect={projection.aspect}\n          style={{\n            pointerEvents: 'none',\n            zIndex: -1,\n          }}\n        >\n          <svg\n            viewBox={`0 0 ${WIDTH} ${WIDTH * projection.aspect}`}\n            style={{\n              position: 'absolute',\n              width: '100%',\n              top: 0,\n              left: 0,\n              overflow: 'hidden',\n              pointerEvents: 'none',\n            }}\n          >\n            {children}\n          </svg>\n        </Regl>\n      </div>\n    </MinimapContext.Provider>\n  )\n}\n\nexport default Minimap\n","import React, { useState, useEffect, useRef } from 'react'\nimport { extname } from 'path'\nimport { useRegl } from './regl'\nimport { useMinimap } from './minimap'\nimport zarr from 'zarr-js'\n\nconst validateGroup = (data, variable) => {\n  if (!Object.keys(data).includes(variable)) {\n    throw new Error(\n      `variable ${variable} not found in zarr dataset, options are: ${Object.keys(\n        data\n      )}`\n    )\n  }\n\n  return true\n}\n\nconst getBounds = ({ data, lat, lon }) => {\n  return {\n    lat: [\n      data[lat].data.reduce((a, b) => Math.min(a, b)),\n      data[lat].data.reduce((a, b) => Math.max(a, b)),\n    ],\n    lon: [\n      data[lon].data.reduce((a, b) => Math.min(a, b)),\n      data[lon].data.reduce((a, b) => Math.max(a, b)),\n    ],\n  }\n}\n\nconst NORTH_POLE = [0, 90]\n\nconst Raster = ({\n  source,\n  variable,\n  mode = 'rgb',\n  colormap = null,\n  clim = null,\n  transpose,\n  northPole = NORTH_POLE,\n  nullValue = -999,\n  bounds = null,\n  lat = 'lat',\n  lon = 'lon',\n}) => {\n  const { viewport, regl } = useRegl()\n  const { scale, translate, projection } = useMinimap()\n\n  if (mode == 'lut' && !colormap) {\n    throw new Error(\"must provide 'colormap' when using 'lut' mode\")\n  }\n\n  if (mode == 'lut' && !clim) {\n    throw new Error(\"must provide 'clim' when using 'lut' mode\")\n  }\n\n  const redraw = useRef()\n  const draw = useRef()\n  const texture = useRef()\n  const lut = useRef()\n  const context = useRef({})\n  const isLoaded = useRef(false)\n  const boundsRef = useRef(null)\n  const zarrGroupCache = useRef()\n  const invalidated = useRef(null)\n\n  useEffect(() => {\n    regl.frame((_context) => {\n      context.current = _context\n\n      if (invalidated.current) {\n        regl.clear({\n          color: [0, 0, 0, 0],\n          depth: 1,\n        })\n\n        redraw.current(invalidated.current)\n      }\n      invalidated.current = null\n    })\n  }, [])\n\n  useEffect(() => {\n    texture.current ||= regl.texture({\n      width: 1,\n      height: 1,\n      data: [0, 0, 0, 0],\n    })\n\n    lut.current ||= regl.texture()\n\n    const position = [\n      0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0,\n    ]\n\n    let uniforms = {\n      pixelRatio: regl.prop('pixelRatio'),\n      viewportWidth: regl.prop('viewportWidth'),\n      viewportHeight: regl.prop('viewportHeight'),\n      texture: regl.prop('texture'),\n      scale: regl.prop('scale'),\n      translate: regl.prop('translate'),\n      northPole: regl.prop('northPole'),\n      transpose: regl.prop('transpose'),\n      nullValue: regl.prop('nullValue'),\n      bounds: regl.prop('bounds'),\n    }\n\n    if (mode === 'lut') {\n      uniforms = {\n        ...uniforms,\n        lut: regl.prop('lut'),\n        clim: regl.prop('clim'),\n      }\n    }\n\n    draw.current = regl({\n      vert: `\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n      attribute vec2 position;\n      varying vec2 uv;\n      void main() {\n        uv = vec2(position.y, position.x);\n        gl_Position = vec4(2.0 * position.x - 1.0, 2.0 * position.y - 1.0, 0.0, 1.0);\n      }\n      `,\n\n      frag: `\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n      varying vec2 uv;\n      uniform vec2 clim;\n      uniform vec4 bounds;\n      uniform float viewportWidth;\n      uniform float viewportHeight;\n      uniform sampler2D texture;\n      uniform float pixelRatio;\n      uniform float scale;\n      uniform vec2 translate;\n      uniform vec2 northPole;\n      uniform bool transpose;\n      uniform float nullValue;\n      ${mode === 'lut' ? 'uniform sampler2D lut;' : ''}\n      ${mode === 'lut' ? 'uniform vec3 nullColor;' : ''}\n\n      const float pi = 3.14159265358979323846264;\n      const float halfPi = pi * 0.5;\n      const float twoPi = pi * 2.0;\n\n      bool isnan(float val)\n      {\n        return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n      }\n\n      vec2 rotateCoords(vec2 coords, vec2 northPole) {\n        // Calculate rotation based of north pole coordinates of rotated grid\n        float phiOffset = northPole.y == 90.0 ? 0.0 : 180.0;\n        float phi = radians(phiOffset + northPole.x);\n        float theta = radians(-1.0 * (90.0 - northPole.y));\n\n        float lon = radians(coords.x);\n        float lat = radians(coords.y);\n\n        // Convert from spherical to cartesian coordinates\n        vec3 unrotatedCoord = vec3(cos(lon) * cos(lat), sin(lon) * cos(lat), sin(lat));\n\n        // From https://en.wikipedia.org/wiki/Rotation_matrix#General_rotations\n        mat3 intrinsicRotation = mat3(\n          cos(phi) * cos(theta), -1.0 * sin(phi), cos(phi) * sin(theta),\n          sin(phi) * cos(theta), cos(phi)       , sin(phi) * sin(theta),\n          -1.0 * sin(theta)    , 0              , cos(theta)\n        );\n\n        vec3 rotatedCoord = intrinsicRotation * unrotatedCoord;\n\n        // Convert from cartesian to spherical coordinates\n        float rotatedLon = degrees(atan(rotatedCoord.y, rotatedCoord.x));\n        float rotatedLat = degrees(asin(rotatedCoord.z));\n\n        return vec2(rotatedLon, rotatedLat);\n      }\n\n      ${projection.glsl.func}\n      void main() {\n        \n        float width = viewportWidth / pixelRatio;\n        float height = viewportHeight / pixelRatio;\n        float x = gl_FragCoord.x / pixelRatio;\n        float y = gl_FragCoord.y / pixelRatio;\n\n        vec2 delta = vec2((1.0 + translate.x) * width / 2.0, (1.0 - translate.y) * height / 2.0);        \n\n        x = (x - delta.x) / (scale * (width / (pi * 2.0)));\n        ${\n          transpose\n            ? `y = (delta.y - y) / (scale * (width / (pi * 2.0)));`\n            : `y = (y - delta.y) / (scale * (width / (pi * 2.0)));`\n        }\n\n        vec2 lookup = ${projection.glsl.name}(x, y);\n        vec2 rotated = rotateCoords(lookup, northPole);\n\n        // Handle points that wrap\n        float offsetX = 0.0;\n        if (rotated.x < bounds[2]) {\n          offsetX = 360.0;\n        } else if (rotated.x > bounds[3]) {\n          offsetX = -360.0;\n        }\n\n        float scaleY = 180.0 / abs(bounds[0] - bounds[1]);\n        float scaleX = 360.0 / abs(bounds[2] - bounds[3]);\n        float translateY = 90.0 + bounds[0];\n        float translateX = 180.0 + bounds[2];\n\n        float rescaledY = scaleY * (radians(rotated.y - translateY) + halfPi) / pi;\n        float rescaledX = scaleX * (radians(rotated.x + offsetX - translateX) + pi) / twoPi;\n\n        vec2 coord;\n        ${\n          transpose\n            ? `coord = vec2(rescaledX, rescaledY);`\n            : `coord = vec2(rescaledY, rescaledX);`\n        }\n\n        vec4 value = texture2D(texture, coord);\n\n        bool inboundsY = rotated.y > bounds[0] && rotated.y < bounds[1];\n        bool inboundsX = rotated.x + offsetX > bounds[2] && rotated.x + offsetX < bounds[3];\n\n        ${\n          mode === 'lut'\n            ? `\n          vec4 c;\n          if ((!inboundsY || !inboundsX) || (value.x == nullValue || isnan(value.x))) {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          } else {\n            float rescaled = (value.x - clim.x)/(clim.y - clim.x);\n            c = texture2D(lut, vec2(rescaled, 1.0));\n            gl_FragColor = vec4(c.x, c.y, c.z, 1.0);\n          }`\n            : ''\n        }\n\n        ${\n          mode === 'rgb'\n            ? `\n          if (value.x == nullValue) {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n          } else {\n            gl_FragColor = vec4(value.x , value.y, value.z, 1.0);\n          }\n        `\n            : ''\n        }\n      }\n      `,\n\n      attributes: {\n        position: position,\n      },\n\n      uniforms: uniforms,\n\n      count: 6,\n\n      primitive: 'triangles',\n    })\n  }, [projection.glsl.name])\n\n  redraw.current = (invalidatedBy) => {\n    if (draw.current && isLoaded.current) {\n      const { pixelRatio } = context.current\n      draw.current({\n        texture: texture.current,\n        lut: lut.current,\n        bounds: boundsRef.current\n          ? [\n              boundsRef.current.lat[0],\n              boundsRef.current.lat[1],\n              boundsRef.current.lon[0],\n              boundsRef.current.lon[1],\n            ]\n          : [-90, 90, -180, 180],\n        scale,\n        translate,\n        northPole,\n        clim,\n        nullValue,\n        viewportWidth: viewport.width * pixelRatio,\n        viewportHeight: viewport.height * pixelRatio,\n        pixelRatio,\n      })\n    }\n  }\n\n  useEffect(() => {\n    // handle loading asynchronously from a specified path\n    if (typeof source === 'string') {\n      const ext = extname(source)\n\n      // handle images\n      if (['.png', '.jpg', '.jpeg'].includes(ext)) {\n        const image = document.createElement('img')\n        image.src = source\n        image.crossOrigin = 'anonymous'\n        image.onload = function () {\n          setTimeout(() => {\n            isLoaded.current = true\n            texture.current(image)\n            invalidated.current = 'on image load'\n          }, 0)\n        }\n      }\n\n      // handle zarr groups and arrays\n      if (ext === '.zarr') {\n        if (variable) {\n          zarr().loadGroup(source, (error, data, metadata) => {\n            validateGroup(data, variable)\n\n            if (!bounds && data[lat] && data[lon]) {\n              boundsRef.current = getBounds({ data, lat, lon })\n            }\n            zarrGroupCache.current = data\n            isLoaded.current = true\n            texture.current(zarrGroupCache.current[variable])\n            invalidated.current = 'on zarr group load'\n          })\n        } else {\n          zarr().load(source, (error, data) => {\n            isLoaded.current = true\n            texture.current(data)\n            invalidated.current = 'on zarr array load'\n          })\n        }\n      }\n      // handle loading synchronously from pre-fetched zarr data\n    } else {\n      if (variable) {\n        validateGroup(source, variable)\n\n        if (!bounds && source[lat] && source[lon]) {\n          boundsRef.current = getBounds({ data: source, lat, lon })\n        }\n\n        zarrGroupCache.current = source\n        isLoaded.current = true\n        texture.current(zarrGroupCache.current[variable])\n        invalidated.current = 'on zarr group read'\n      } else {\n        isLoaded.current = true\n        texture.current(source)\n        invalidated.current = 'on zarr array read'\n      }\n    }\n  }, [source, lat, lon])\n\n  useEffect(() => {\n    // handle variable change on cached zarr group data\n    if (zarrGroupCache.current) {\n      texture.current(zarrGroupCache.current[variable])\n      invalidated.current = 'on variable change'\n    }\n  }, [variable])\n\n  useEffect(() => {\n    if (bounds) {\n      boundsRef.current = bounds\n    }\n    invalidated.current = 'on bounds change'\n  }, [\n    bounds && bounds.lat[0],\n    bounds && bounds.lat[1],\n    bounds && bounds.lon[0],\n    bounds && bounds.lon[1],\n  ])\n\n  useEffect(() => {\n    if (colormap) {\n      lut.current({\n        data: colormap,\n        format: 'rgb',\n        shape: [colormap.length, 1],\n      })\n      invalidated.current = 'on colormap change'\n    }\n  }, [colormap])\n\n  useEffect(() => {\n    invalidated.current = 'on viewport change'\n  }, [viewport])\n\n  useEffect(() => {\n    invalidated.current = 'on prop change'\n  }, [\n    clim && clim[0],\n    clim && clim[1],\n    mode,\n    scale,\n    translate[0],\n    translate[1],\n    northPole ? northPole[0] : undefined,\n    northPole ? northPole[1] : undefined,\n    nullValue,\n    projection,\n  ])\n\n  return null\n}\n\nexport default Raster\n","import React from 'react'\nimport { geoPath, geoGraticule } from 'd3-geo'\nimport { useMinimap } from './minimap'\n\nconst Graticule = ({\n  stroke,\n  strokeWidth = 0.5,\n  step = [45, 45],\n  opacity = 0.2,\n}) => {\n  const { projection, width, height } = useMinimap()\n\n  const eps = projection.id === 'mercator' ? 0 : 0.1\n\n  return (\n    <path\n      d={geoPath(projection)(\n        geoGraticule()\n          .step(step)\n          .extentMajor([\n            [-180 - eps, -90 - eps],\n            [180 + eps, 90 + eps],\n          ])()\n      )}\n      stroke={stroke}\n      fill={'none'}\n      opacity={opacity}\n      strokeWidth={strokeWidth}\n      style={{\n        vectorEffect: 'non-scaling-stroke',\n      }}\n    />\n  )\n}\n\nexport default Graticule\n","import React, { useEffect, useState } from 'react'\nimport { geoPath } from 'd3-geo'\nimport { feature as topoFeature } from 'topojson-client'\nimport { useMinimap } from './minimap'\n\nconst Path = ({\n  source,\n  feature,\n  fill = 'none',\n  stroke = 'none',\n  strokeWidth = 0.5,\n  opacity = 0.7,\n}) => {\n  const [path, setPath] = useState()\n  const [data, setData] = useState()\n  const { projection, width, height } = useMinimap()\n\n  useEffect(() => {\n    fetch(source)\n      .then((response) => response.json())\n      .then((topology) => {\n        setData(topoFeature(topology, topology.objects[feature]))\n      })\n  }, [source])\n\n  useEffect(() => {\n    setPath(geoPath(projection)(data))\n  }, [data, projection])\n\n  return (\n    <path\n      d={path}\n      stroke={stroke}\n      fill={fill}\n      opacity={opacity}\n      strokeWidth={strokeWidth}\n      style={{\n        vectorEffect: 'non-scaling-stroke',\n      }}\n    />\n  )\n}\n\nexport default Path\n","import React, { useState, useEffect } from 'react'\nimport { geoPath } from 'd3-geo'\nimport { useMinimap } from './minimap'\n\nconst Sphere = ({ fill, stroke, strokeWidth = 0.5, opacity = 0.2 }) => {\n  const { projection, width, height } = useMinimap()\n  const [path, setPath] = useState()\n  // replace with uui\n  const id = String(Math.floor(Math.random() * 100))\n\n  useEffect(() => {\n    setPath(geoPath(projection)({ type: 'Sphere' }))\n  }, [projection])\n\n  return (\n    <svg\n      viewBox={`0 0 ${width} ${height}`}\n      style={{ position: 'absolute', width: '100%', top: 0, left: 0 }}\n    >\n      <mask id={id}>\n        <rect x='0' y='0' width='100%' height='100%' fill='#FFFFFF' />\n        <path fill='#000000' id='circle-cutout' d={path} />\n      </mask>\n      <rect\n        x='0'\n        y='0'\n        width='100%'\n        height='100%'\n        mask={`url(#${id})`}\n        style={{ fill: fill }}\n      />\n      {stroke && (\n        <path\n          fill='none'\n          stroke={stroke}\n          strokeWidth={strokeWidth}\n          opacity={opacity}\n          style={{\n            vectorEffect: 'non-scaling-stroke',\n          }}\n          d={path}\n        />\n      )}\n    </svg>\n  )\n}\n\nexport default Sphere\n"],"names":["ReglContext","createContext","Regl","_ref","style","aspect","children","regl","useRef","container","resize","_useState","useState","ready","setReady","_useState2","width","height","viewport","setViewport","useEffect","current","offsetWidth","window","addEventListener","_regl","extensions","removeEventListener","destroy","React","createElement","Provider","value","_extends","ref","DEFAULTS","naturalEarth1","scale","translate","orthographic","mercator","equirectangular","MinimapContext","useMinimap","useContext","validateGroup","data","variable","Object","keys","includes","Error","getBounds","lat","lon","reduce","a","b","Math","min","max","NORTH_POLE","stroke","_ref$strokeWidth","strokeWidth","_ref$step","step","_ref$opacity","opacity","projection","eps","id","d","geoPath","geoGraticule","extentMajor","fill","vectorEffect","tabIndex","className","getProjection","aspectProp","scaleProp","translateProp","setProjection","WIDTH","updatedProjection","defaults","updatedScale","updatedAspect","updatedTranslate","PI","position","overflow","pointerEvents","zIndex","viewBox","top","left","source","feature","_ref$fill","_ref$stroke","path","setPath","setData","fetch","then","response","json","topology","topoFeature","objects","_ref2","_ref2$mode","mode","_ref2$colormap","colormap","_ref2$clim","clim","transpose","_ref2$northPole","northPole","_ref2$nullValue","nullValue","_ref2$bounds","bounds","_ref2$lat","_ref2$lon","_useRegl","_useMinimap","redraw","draw","texture","lut","context","isLoaded","boundsRef","zarrGroupCache","invalidated","frame","_context","clear","color","depth","uniforms","pixelRatio","prop","viewportWidth","viewportHeight","vert","frag","glsl","func","name","attributes","count","primitive","invalidatedBy","ext","extname","image","document","src","crossOrigin","onload","setTimeout","zarr","loadGroup","error","metadata","load","format","shape","length","undefined","String","floor","random","type","x","y","mask"],"mappings":"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"}